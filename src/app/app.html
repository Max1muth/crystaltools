<div class="editor-container">
  <div class="canvas-section">
    <div class="canvas-wrapper">
      <div class="background-layer" [style.backgroundImage]="backgroundImage ? 'url(' + backgroundImage + ')' : 'none'"></div>
      <canvas #mainCanvas (mousedown)="onMouseDown($event)" (mousemove)="onMouseMove($event)" (mouseup)="onMouseUp()"></canvas>
    </div>
  </div>

  <div class="side-panel">
    <div class="panel-header">Crystools v1.0</div>
    
    <div class="control-row">
      <div class="row-label"><span>Угол:</span> <b>{{ angle | number:'1.0-0' }}°</b></div>
      <div class="rotation-main">
        <button class="mini-btn" (click)="angle = (angle - 15 + 360) % 360">↺</button>
        <input type="range" min="0" max="360" [(ngModel)]="angle">
        <button class="mini-btn" (click)="angle = (angle + 15) % 360">↻</button>
      </div>
      <div class="precision-grid">
        <button class="micro-btn" (click)="angle = (angle - 1 + 360) % 360">-1°</button>
        <button class="micro-btn reset" (click)="angle = 0">СБРОС</button>
        <button class="micro-btn" (click)="angle = (angle + 1) % 360">+1°</button>
      </div>
    </div>

    <hr class="divider">

    <div class="control-row">
      <div class="row-label"><span>Альфа:</span> <b>{{ opacity }}%</b></div>
      <input type="range" min="0" max="100" step="25" [(ngModel)]="opacity" list="opacity-steps">
    </div>

    <div class="control-row inline" style="justify-content: flex-start; gap: 8px;">
      <span class="label">Цвет:</span>
      <input type="color" [(ngModel)]="brushColor" class="color-picker-simple">
    </div>

    <hr class="divider">

    <div class="file-actions">
      <button class="btn-secondary" (click)="saveImage()">СКАЧАТЬ СЛОЙ</button>
      <button class="btn-secondary btn-upload" (click)="triggerLayerInput()">ЗАГРУЗИТЬ В СЛОЙ</button>
    </div>

    <hr class="divider">

    <div class="tools-grid">
      <button [class.active]="mode === 'simple'" (click)="mode = 'simple'">Кисть</button>
      <button [class.active]="mode === 'extrapolation'" (click)="mode = 'extrapolation'">Точки</button>
      <button (click)="clear_points()">Очистить</button>
      <button (click)="triggerFileInput()">ФОН</button>
    </div>

    <button class="btn-primary" (click)="extrapolate()">ЭКСТРАПОЛИРОВАТЬ</button>
    
    <button (click)="undo()" [disabled]="history.length === 0" title="Отменить последнее действие">
    UNDO
    </button>
    
    <input type="file" (change)="onFileSelected($event)" id="fileInput" style="display:none" accept="image/*">
    <input type="file" (change)="onLayerFileSelected($event)" id="layerInput" style="display:none" accept="image/*">
  </div>
</div>

<datalist id="opacity-steps">
  <option value="0"></option><option value="25"></option><option value="50"></option><option value="75"></option><option value="100"></option>
</datalist>
<div class="editor-container">
  <div class="canvas-section">
    <div class="canvas-wrapper">
      <canvas #mainCanvas 
        (mousedown)="onMouseDown($event)" 
        (mousemove)="onMouseMove($event)" 
        (mouseup)="onMouseUp()"
        (touchstart)="onTouchStart($event)"
        (touchmove)="onTouchMove($event)"
        (touchend)="onMouseUp()">
      </canvas>
    </div>
  </div>

  <div class="side-panel">
    <div class="panel-header">Crystools v1.8</div>
    
    <div class="control-row">
      <div class="row-label">
        <span>–ù–∞–≤–∏–≥–∞—Ü–∏—è:</span> 
        <b [style.color]="mode === 'move' ? '#03dac6' : '#e0e0e0'">
          {{ mode === 'move' ? '–ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï' : ((zoom * 100) | number:'1.0-0' + '%') }}
        </b>
      </div>
      <div class="rotation-main">
        <button class="mini-btn" (click)="zoom = zoom > 1.1 ? zoom - 0.2 : 1">Ôºç</button>
        <input type="range" min="1" max="4" step="0.1" [(ngModel)]="zoom">
        <button class="mini-btn" (click)="zoom = zoom < 3.9 ? zoom + 0.2 : 4">Ôºã</button>
      </div>
      <div class="precision-grid">
        <button class="micro-btn" [class.active-move]="mode === 'move'" (click)="toggleMoveMode()">
          {{ mode === 'move' ? '‚úÖ –†–£–ö–ê' : 'üñêÔ∏è –†–£–ö–ê' }}
        </button>
        <button class="micro-btn" (click)="cycleZoom()">
          –ó–£–ú: {{ (zoom | number:'1.0-1') }}x
        </button>
        <button class="micro-btn" (click)="resetView()">–°–ë–†–û–°</button>
      </div>
    </div>

    <hr class="divider">

    <div class="control-row">
      <div class="row-label"><span>–£–≥–æ–ª:</span> <b>{{ angle | number:'1.0-0' }}¬∞</b></div>
      <div class="rotation-main">
        <button class="mini-btn" (click)="angle = (angle - 15 + 360) % 360">‚Ü∫</button>
        <input type="range" min="0" max="360" [(ngModel)]="angle">
        <button class="mini-btn" (click)="angle = (angle + 15) % 360">‚Üª</button>
      </div>
      <div class="precision-grid">
        <button class="micro-btn" (click)="angle = (angle - 1 + 360) % 360">-1¬∞</button>
        <button class="micro-btn reset" (click)="angle = 0">0¬∞</button>
        <button class="micro-btn" (click)="angle = (angle + 1) % 360">+1¬∞</button>
      </div>
    </div>

    <hr class="divider">

    <div class="control-row inline">
      <span class="label">–¶–≤–µ—Ç –∫–∏—Å—Ç–∏:</span>
      <input type="color" [(ngModel)]="brushColor" class="color-picker-simple">
    </div>

    <hr class="divider">

    <div class="file-actions">
      <button class="btn-secondary" (click)="saveImage()">–°–ö–ê–ß–ê–¢–¨ –°–õ–û–ô</button>
      <button class="btn-secondary btn-upload" (click)="triggerLayerInput()">–ó–ê–ì–†–£–ó–ò–¢–¨ –í –°–õ–û–ô</button>
    </div>

    <hr class="divider">

    <div class="tools-grid">
      <button [class.active]="mode === 'simple'" (click)="mode = 'simple'">–ö–∏—Å—Ç—å</button>
      <button [class.active]="mode === 'extrapolation'" (click)="mode = 'extrapolation'">–¢–æ—á–∫–∏</button>
      <button (click)="undo()" [disabled]="history.length <= 1">UNDO</button>
      <button (click)="clear_points()">–û—á–∏—Å—Ç–∏—Ç—å</button>
      <button (click)="triggerFileInput()" style="grid-column: span 2;">–ò–ó–ú–ï–ù–ò–¢–¨ –§–û–ù</button>
    </div>

    <button class="btn-primary" 
            (click)="extrapolate()" 
            [disabled]="mode !== 'extrapolation' || ext_buffer.length < 2">
      –≠–ö–°–¢–†–ê–ü–û–õ–ò–†–û–í–ê–¢–¨
    </button>
    
    <input type="file" (change)="onFileSelected($event)" id="fileInput" style="display:none" accept="image/*">
    <input type="file" (change)="onLayerFileSelected($event)" id="layerInput" style="display:none" accept="image/*">
  </div>
</div>